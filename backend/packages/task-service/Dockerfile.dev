FROM node:18-alpine

WORKDIR /app/backend

# Copy workspace files
COPY package*.json ./
COPY tsconfig*.json ./
COPY lerna.json ./

# Copy all packages
COPY packages ./packages

# Install dependencies
RUN npm install

# Build shared-kernel first
RUN cd packages/shared-kernel && npm run build

# Build task-service
RUN cd packages/task-service && npm run build

# Expose port
EXPOSE 3455

# Start the service
CMD ["npm", "run", "--prefix", "packages/task-service", "dev"]
